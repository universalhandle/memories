{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"changelog/","title":"Changelog","text":"<p>All notable changes to this project will be documented in this file.</p>"},{"location":"changelog/#v521-2023-07-03","title":"[v5.2.1] - 2023-07-03","text":"<ul> <li>Feature: Allow moving unclustered faces to a cluster with Recognize (v4.2.0+)</li> </ul>"},{"location":"changelog/#v520-2023-06-30","title":"[v5.2.0] - 2023-06-30","text":"<p>Note: You will need to run <code>occ memories:places-setup --recalculate</code> to re-index places (or reindex everything)</p> <ul> <li>New project home page: https://memories.gallery</li> <li>New Discord community: https://discord.gg/7Dr9f9vNjJ</li> <li>Nextcloud 27 compatibility</li> <li>Feature: Hierarchical places view</li> <li>Feature: Layout improvements especially for mobile.</li> <li>Feature: Allow downloading entire publicly shared albums.</li> <li>Feature: Basic preview generation configuration in admin interface.</li> <li>Bugfix: Prevent keeping original file on metadata edit.</li> <li>Bugfix: Use correct locale for time in metadata view.</li> <li>Bugfix: Allow editing metadata on large video files.</li> </ul>"},{"location":"changelog/#v510-2023-04-29","title":"[v5.1.0] - 2023-04-29","text":"<ul> <li>Feature: Allow creating new cluster in recognize while moving faces.</li> <li>Feature: Allow specifying precise coordinates while editing GPS metadata.</li> <li>Feature: Whitelist x-msvideo mime type.</li> <li>Fix: Improved handling of duplicate Live Photos.</li> <li>Fix: Prevent zombie processes when running in Docker.</li> <li>Breaking: Recognize v3.8 (minimum) is now required.</li> </ul>"},{"location":"changelog/#v500-2023-04-16","title":"[v5.0.0] - 2023-04-16","text":"<p>Note: this is a major release and may introduce breaking changes to your workflow.</p> <ul> <li>Feature: You can now configure Memories from the admin panel.   To access the admin panel, go to the admin settings and click on the \"Memories\" tab.</li> <li>Breaking: The <code>memories:video-setup</code> command has been removed.   Transcoding with or without hardware acceleration must now be configured from the admin panel.   For running an external go-vod instance, specifying a configuration file is no longer required.</li> <li>Breaking: The transcoder and exiftool binaries will be copied to the temp directory before execution.   Make sure your temp directory is writable by the web server.</li> <li>Breaking: The <code>--cleanup</code> flag to <code>memories:index</code> has been removed and is no longer necessary.   Folders having a <code>.nomedia</code> file will automatically be excluded from the timeline.</li> <li>Feature: Indexing will now build and check indices automatically in the backgroud.   Make sure Nextcloud cron is configured correctly. You can disable automatic indexing in the admin panel.   Note that files are still indexed immediately on upload.</li> <li>Feature: You can now choose which folders to index by default.   This can be configured from the admin panel. The available options are:</li> <li>All media files (excluding folders with <code>.nomedia</code> files, default and recommended)</li> <li>All files in every user's configured timeline folder (not recommended).</li> <li>All files in a given folder for each user (relative path).</li> <li>Feature: You can now run indexing in parallel on multiple threads. <code>for i in {1..4}; do (occ memories:index &amp;); done</code></li> <li>Feature: Image editing is now done server-side, and is much faster and more reliable.</li> <li>PHP Imagick extension is now required for image editing.</li> <li>This fixes multiple issues editing images especially in Firefox.</li> <li>Feature: Significant performance improvements for the timeline view.</li> </ul>"},{"location":"changelog/#v4131-2023-04-03","title":"[v4.13.1] - 2023-04-03","text":"<ul> <li>Feature: \"Direct\" video playback will now fall back to HLS (transcoding) if playback fails (e.g. due to lack of browser support).</li> </ul>"},{"location":"changelog/#v4130-2023-04-03","title":"[v4.13.0] - 2023-04-03","text":"<ul> <li>Feature: Use GPS location data for timezone calculation.   Many cameras do not store the timezone in EXIF data. This feature allows Memories to use the GPS location data to calculate the timezone. To take advantage of this, you will need to run <code>occ memories:places-setup</code> followed by <code>occ memories:index --clear</code> (or <code>occ memories:index -f</code>) to reindex your photos.</li> <li>Feature: You can now specify the user and/or folder to index when running <code>occ memories:index</code> (#184).</li> <li>Feature: The map view now has a much more flexible layout, especially on mobile.</li> <li>Feature: Support for Google MVIMG photos (#468)</li> </ul>"},{"location":"changelog/#v4125-2023-03-23","title":"[v4.12.5] - 2023-03-23","text":"<ul> <li>These releases significantly overhaul the application logic for better maintainability. If you run into any regressions, please file a bug report.</li> </ul>"},{"location":"changelog/#v4122-2023-03-17","title":"[v4.12.2] - 2023-03-17","text":"<ul> <li>Feature: Allow migrating Google Takeout metadata to EXIF (#430)</li> </ul>"},{"location":"changelog/#v4121-2023-03-15","title":"[v4.12.1] - 2023-03-15","text":"<ul> <li>Feature: Load full image on zoom (#266)</li> </ul>"},{"location":"changelog/#v4120-2023-03-10","title":"[v4.12.0] - 2023-03-10","text":"<p>This release drops support for Nextcloud 24.</p> <p>Make sure you run at least Nextcloud 25.0.4 PHP 7.4 support is now deprecated. Please upgrade to at least PHP 8.0. You may need to clear browser cache to use location search.</p> <ul> <li>Feature: Allow editing of GPS coordinates (#418)</li> <li>Feature: Allow bulk editing of EXIF attributes other than date/time</li> <li>Feature: Allow (optionally bulk) editing of collaborative tags</li> <li>Feature: Allow sharing single photo / video (#307)</li> <li>Feature: Allow sharing photos in high/low resolution.</li> <li>Feature: Allow sharing videos (#261)</li> <li>Feature: Show list of tags in sidebar</li> <li>Feature: Better configurability and feature detection for go-vod (#450)</li> <li>Feature: Configurable folder/album sorting order (#371)</li> <li>Feature: Configurable album list sorting order (#377)</li> <li>Feature: Allow archiving photos through folder view (#350)</li> <li>Feature: Add search bar to face cluster merge dialog (#177)</li> <li>Bugfix: Sidebar now shows metadata on albums and public shares (#320).</li> <li>Other fixes and features (milestone)</li> </ul>"},{"location":"changelog/#v4110-2023-02-10","title":"[v4.11.0] - 2023-02-10","text":"<ul> <li>Feature: Show map of photos (#396)   To index existing images, you must run <code>occ memories:index -f</code></li> <li>Feature: Show list of places using reverse geocoding (MySQL/Postgres only) (#395)   To configure this feature, you need to run <code>occ memories:places-setup</code> followed by <code>occ memories:index -f</code></li> <li>Other minor fixes and features (milestone)</li> </ul>"},{"location":"changelog/#v4100-2023-01-17","title":"[v4.10.0] - 2023-01-17","text":"<ul> <li>Feature: Allow sharing albums using public links (#274)</li> <li>Feature: Allow sharing albums with groups (#329)</li> <li>Feature: Directly move photos from the timeline to any folder (#321)</li> <li>Feature: Optionally view folders in the recursive timeline view (#260)</li> <li>Fix folder share title and remove footer (#323)</li> <li>Other minor fixes (milestone)</li> </ul>"},{"location":"changelog/#v490-2022-12-08","title":"[v4.9.0] - 2022-12-08","text":"<ul> <li>Important: v4.9.0 comes with an optimization that greatly reduces CPU usage for preview serving. However, for best experience, the preview generator app is now required to be configured properly. Please install it from the app store.</li> <li>Feature: Slideshow for photos and videos (#217)</li> <li>Feature: Support for GPU transcoding (#194)</li> <li>Feature: Allow downloading entire albums</li> <li>Feature: Allow editing more EXIF fields (#169)</li> <li>Feature: Alpha integration with the face recognition app (#146)</li> <li>Fix downloading from albums (#259)</li> <li>Fix support for HEVC Live Photos (#234)</li> <li>Fix native photo sharing (#254, #263)</li> <li>Use larger previews in viewer (please see these docs) (#226)</li> </ul>"},{"location":"changelog/#v480-2022-11-22","title":"[v4.8.0] - 2022-11-22","text":"<ul> <li>Feature: Support for Live Photos (#124)</li> <li>You need to run <code>occ memories:index --clear</code> to reindex Live Photos</li> <li>Only JPEG (iOS with MOV, Google, Samsung) is supported. HEIC is not supported.</li> <li>Feature: Timeline path now scans recursively for mounted volumes / shares inside it</li> <li>Feature: Multiple timeline paths can be specified (#178)</li> <li>Support for server-side encrypted storage (#99)</li> <li>Mouse wheel now zooms on desktop</li> <li>Improved caching performance</li> <li>Due to incorrect caching in previous versions, your browser cache may have become very large. You can clear it to save some space.</li> </ul>"},{"location":"changelog/#v470-2022-11-14","title":"[v4.7.0] - 2022-11-14","text":"<ul> <li>Note: you must run <code>occ memories:index -f</code> to take advantage of new features.</li> <li>Massively improved video performance</li> <li>Memories now comes with a dedicated transcoding server with HLS support.</li> <li>Read the documentation here carefully for more details.</li> <li>Feature: Show EXIF metadata in sidebar (#68)</li> <li>Feature: Multi-selection with drag (mobile) and shift+click (#28)</li> <li>Feature: Show duration on video tiles</li> <li>Feature: Allow editing all image formats (HEIC etc.)</li> <li>Fix stretched images in viewer (#176)</li> <li>Restore metadata after image edit (#174)</li> <li>Fix loss of resolution after image edit</li> </ul>"},{"location":"changelog/#v461-2022-11-07","title":"[v4.6.1] - 2022-11-07","text":"<ul> <li>Feature: Native sharing from the viewer (images only)</li> <li>Feature: Deep linking to photos on opening viewer</li> <li>Feature: Password protected folder shares (#165)</li> <li>Feature: Folders view will now show only folders with photos (#163)</li> <li>Improvements to viewer UX</li> <li>Restore image editor (see v4.6.0)</li> </ul>"},{"location":"changelog/#v460-2022-11-06","title":"[v4.6.0] - 2022-11-06","text":"<ul> <li>Brand new photo viewer with improved touch interface and UX</li> <li>Improvements from v4.5.4 below</li> <li>Known regressions: Photo Editor and Slideshow are not implemented yet</li> <li>New layout for Albums view (date ascending, grouped by month)</li> <li>Re-enable viewer editing and deletion</li> </ul>"},{"location":"changelog/#v452-2022-10-30","title":"[v4.5.2] - 2022-10-30","text":"<ul> <li>Improved scroller performance</li> <li>Improved support for external storage and FreeBSD</li> <li>Improved selection of photos</li> </ul>"},{"location":"changelog/#v450-2022-10-28","title":"[v4.5.0] - 2022-10-28","text":"<ul> <li>Feature: Album sharing to other Nextcloud users</li> <li>Feature: Folder sharing with public link #74</li> <li>Performance improvements and bug fixes</li> </ul>"},{"location":"changelog/#v441-2022-10-27","title":"[v4.4.1] - 2022-10-27","text":"<ul> <li>Feature: Albums support for Nextcloud 25 (alpha)</li> <li>Performance improvements and bug fixes</li> </ul>"},{"location":"changelog/#v438-2022-10-26","title":"[v4.3.8] - 2022-10-26","text":"<ul> <li>Feature: Full screen viewer on desktop</li> <li>Feature: Allow opening people and tags in new tab</li> <li>Bugfix: Fix regression in performance with large number of files</li> <li>Bugfix: Improve image quality on mobile</li> </ul>"},{"location":"changelog/#v437-2022-10-24","title":"[v4.3.7] - 2022-10-24","text":"<ul> <li>Feature: Support for RAW (must run <code>occ memories:index</code> after upgrade) with camera raw previews app (#107)</li> <li>Feature: Better settings experience.</li> <li>Feature: Better first start experience.</li> <li>Bug fixes for postgresql and mysql</li> </ul>"},{"location":"changelog/#v430-2022-10-22","title":"[v4.3.0] - 2022-10-22","text":"<ul> <li>Note: you must run <code>occ memories:index -f</code> after updating to take advantage of new features.</li> <li>Feature: Brand new tiled layout for photos</li> <li>Feature: Photos from \"On this day\" are now shown at the top of the timeline</li> <li>Feature: Move selected photos from one person to another (#78)</li> <li>Feature: Highlight faces in People view (#79)</li> <li>Feature: Choose root folder for Folders view (#85)</li> <li>No longer need to install exiftool. It will be bundled with the app.</li> <li>Improve overall performance with caching</li> <li>Basic offline support with cache</li> <li>Improve scroller performance</li> <li>Improve faces view performance</li> </ul>"},{"location":"changelog/#v422-2022-10-12","title":"[v4.2.2] - 2022-10-12","text":"<ul> <li>Update to mobile layout with improved performance</li> <li>Show how old photos are in <code>On this day</code></li> </ul>"},{"location":"changelog/#v421-2022-10-11","title":"[v4.2.1] - 2022-10-11","text":"<ul> <li>Fix incorrect layout of <code>On this day</code></li> </ul>"},{"location":"changelog/#v420-2022-10-11","title":"[v4.2.0] - 2022-10-11","text":"<ul> <li>Allow renaming and merging recognize faces</li> <li>Bug fixes</li> </ul>"},{"location":"changelog/#v410-2022-10-08","title":"[v4.1.0] - 2022-10-08","text":"<ul> <li>First release for Nextcloud 25</li> </ul>"},{"location":"changelog/#v300-2022-10-07","title":"[v3.0.0] - 2022-10-07","text":"<ul> <li>People tab with faces from recognize app</li> <li>Tags tab with objects from recognize app</li> <li>On this day tab</li> <li>Bug fixes and performance improvements</li> </ul>"},{"location":"changelog/#v213-2022-09-27","title":"[v2.1.3] - 2022-09-27","text":"<ul> <li>Bug fixes and optimized performance</li> </ul>"},{"location":"changelog/#v212-2022-09-25","title":"[v2.1.2] - 2022-09-25","text":"<ul> <li>Breadcrumb navigation in folder view</li> <li>Edit Exif date feature (use with care)</li> <li>Archive photos function</li> <li>Improved localization and performance</li> </ul>"},{"location":"changelog/#v200-2022-09-23","title":"[v2.0.0] - 2022-09-23","text":"<ul> <li>Note: you must re-run <code>occ memories:index</code> after updating.</li> <li>Support for external storage and shared folders for timeline.</li> <li>Localization support. Many languages already available.</li> <li>Select and favorite / unfavorite photos</li> </ul>"},{"location":"changelog/#v116-2022-09-15","title":"[v1.1.6] - 2022-09-15","text":"<ul> <li>New feature: Select photos from an entire day together</li> <li>Fix: Timeline with nested folders</li> </ul>"},{"location":"changelog/#v115-2022-09-15","title":"[v1.1.5] - 2022-09-15","text":"<ul> <li>Fix for postgres</li> <li>Fix for Exiftool crash</li> </ul>"},{"location":"changelog/#v114-2022-09-13","title":"[v1.1.4] - 2022-09-13","text":"<ul> <li>PHP 7.4 support</li> <li>Bug fixes</li> </ul>"},{"location":"changelog/#v110-2022-09-13","title":"[v1.1.0] - 2022-09-13","text":"<ul> <li>Support for external storage</li> <li>Favorites and Videos tabs</li> <li>Improved performance</li> <li>Better support for folder shares</li> </ul>"},{"location":"changelog/#v101-2022-09-08","title":"[v1.0.1] - 2022-09-08","text":"<ul> <li>Initial release</li> </ul>"},{"location":"config/","title":"Configuration","text":"<p>Starting with v5.0.0, you can fully configure memories using the admin panel. With an admin account in Nextcloud, go to <code>Settings -&gt; Memories</code>. Memories runs a background indexing job to extract EXIF metadata from photos and videos, as well as immediately on every upload.</p> <p>If you just installed memories and want to speed up indexing, run the following commands. For usage of the <code>occ</code> command line, refer here for more information.</p> <pre><code>occ memories:places-setup    # set up reverse geocoding, will force re-indexing\nocc memories:index           # index existing photo files (can run in parallel, refer to admin panel)\n</code></pre> <p>OCCWeb</p> <p>The OCCWeb app is deprecated, and will not work with Memories. You must use the <code>occ</code> command line.</p> <p>Cron</p> <p>You DO NOT need to set up a cron job or run <code>occ memories:index</code> periodically, since this is handled internally. Any subsequently uploaded files will be indexed automatically with hooks. In case you upload files externally and run <code>files:scan</code>, the background job will index these files. Make sure Nextcloud cron is configured correctly.</p> <p>OCC with Docker</p> <p>If you are using docker, make sure you run these commands with an interactive TTY. For example,</p> <pre><code>docker exec -it my_nc_container php occ memories:index\n#           ^^^  &lt;-- this is required\n</code></pre>"},{"location":"config/#storage-support","title":"Storage support","text":"<p>The app can work with external storage for photos. Just set the mountpoint as the timeline directory.</p> <ul> <li>If you add any photos from outside Nextcloud, you must run the scan and index commands.</li> <li>Indexing may be slow, since all files must be downloaded from the storage.</li> </ul> <p>Transcoding with external storage</p> <p>Video transcoding requires the entire file to be available locally for ffmpeg. To prevent downloading the entire for every playback, transcoding is disabled for external storage.</p>"},{"location":"config/#imagevideo-support","title":"Image/Video support","text":"<p>To get support for all file types including HEIC, TIFF and RAW, refer to this page.</p> <p>To enable support for high resolution images, you need to update Nextcloud's <code>config.php</code> to include</p> <pre><code>'preview_max_memory' =&gt; 4096,\n'preview_max_filesize_image' =&gt; 256,\n</code></pre>"},{"location":"config/#transcoding","title":"Transcoding","text":"<p>Memories bundles a transcoding server with HLS capabilites for adaptive streaming. You need to configure transcoding to be able to play any videos. HLS enables the browser to download the video as small chunks and in resolutions adaptive to the connection speed. As a result, this is usually expected to have a major boost in video experience and performance.</p> <p>You can configure transcoding from the admin panel. Make sure to test all settings carefully on different kinds of videos.</p> <p>Read the following considerations carefully regarding transcoding:</p> <ol> <li>In general, transcoding can be very compute intensive. If you run Nextcloud on an RPi, it will not work for you.</li> <li>If you use external storage, transcoding might be very slow or not work at all. In this case, you should disable it.</li> <li>Make sure there is a lot of space available in <code>/tmp</code> for the transcoded files.</li> <li>If transcoding fails, the video player will fall back to the original video stream. Check the output of <code>/tmp/go-vod/&lt;instanceid&gt;.log</code></li> <li>For better performance, you may configure the transcoder to use hardware acceleration. See this page.</li> </ol>"},{"location":"config/#reverse-geocoding","title":"Reverse geocoding","text":"<p>Memories supports reverse geocoding to find the location of photos. To set up geocoding you need to download the planet boundary dataset and store it in the database. This works only on MySQL/MariaDB/Postgres (no SQLite support). To set up, go to the admin panel. Note that all your files will be re-indexed after downloading the planet database.</p>"},{"location":"config/#recommended-apps","title":"Recommended apps","text":"<ul> <li>Preview Generator - For pre-generating image previews (required for best performance)</li> <li>Recognize - The official Nextcloud app for AI tagging of images and people.</li> <li>Photos - The official Nextcloud Photos app, required for albums support.</li> <li>Face Recognition - An alternative face recognition app, which offers more fine-tuning. Alpha stage integration.</li> </ul>"},{"location":"config/#preview-storage","title":"Preview storage","text":"<p>By default, previews upto <code>4096px</code> size are generated by Nextcloud. Each of the largest previews might be a few megabytes in size. This may not be ideal if you have limited storage space, since the preview size may become larger than the originals (especially if you use efficient image formats like HEIC). In this case, you can limit previews to a smaller size like <code>2048px</code>.</p> <p>Note that Memories will, by default, load the full image upon zooming in. If you are okay with this, you may use a even smaller size like <code>1024px</code> to save more space as well as faster preview generation time. Non-JPEG files will be converted on the server when loading in full-res, which may lead to some server load.</p> <pre><code>'preview_max_x' =&gt; 2048,\n'preview_max_y' =&gt; 2048,\n</code></pre> <p>You can also set the preview JPEG quality to 80 to save more space.</p> <pre><code>occ config:app:set preview jpeg_quality --value=\"80\"\n</code></pre> <p>If you already generated previews and want to regenerate, run the following (at your own risk; have backups)</p> <pre><code>rm -rf &lt;nextcloud-data-dir&gt;/appdata_*/preview\nocc files:scan-app-data\n</code></pre>"},{"location":"config/#migration","title":"Migration","text":"<p>Memories directly uses EXIF metadata from files, so migration should be generally easy. The file structure of your photos is preserved as-is.</p> <p>If you are migrating from Nextcloud Photos, you don't need to do anything. Your albums and tags will be carried to Memories as-is.</p> <p>If you are migrating from Google Takeout, you may run the following command to move JSON metadata to EXIF.</p> <pre><code>occ memories:migrate-google-takeout\n</code></pre>"},{"location":"config/#other-notes","title":"Other notes","text":"<ul> <li>For optimal performance, enable HTTP/2 on your reverse proxy (nginx/apache)</li> <li>Make sure your server timezone is configured correctly. If a photo does not contain an EXIF date, the server time is used.</li> <li>Perform additional server tuning for Nextcloud. See the docs.</li> <li>The archive feature moves photos to a separate folder called <code>.archive</code> at the root of your timeline. You can, for example, mount this folder to a cold storage.</li> </ul>"},{"location":"faq/","title":"Help and FAQ","text":""},{"location":"faq/#getting-help","title":"Getting Help","text":"<p>If you have any questions, feel free to reach out at</p> <ul> <li>Discord community (any questions, feedback, suggestions, etc.)</li> <li>GitHub issues (bugs and feature requests)</li> </ul>"},{"location":"faq/#faq","title":"FAQ","text":"<p>How is it different from the default Nextcloud Photos app?</p> <p>You can find a full comparison here.</p> <p>What apps does Memories compete against?</p> <p>Commercial cloud photo services. The target is to be better than <code>X</code> service provider that you pay $$$ for, and be usable by grandma.</p> <p>Is it production ready?</p> <p>Yes.</p> <p>Does it support multiple users and external sharing?</p> <p>Yes.</p> <p>Why is it tied to Nextcloud? Isn't this a lot of overhead? Isn't PHP slow?</p> <ol> <li>Reinventing the wheel is pointless. If Memories was a dedicated app, that would mean re-implementing everything from automatic file upload to multi-user support and auth integrations. The maintenance overhead of such a codebase increases exponentially, all while completely unnecessary since someone else is maintaining the exact same things in another piece of software. Integrating with Nextcloud is what makes Memories sustainable.</li> <li>PHP and Nextcloud have become very fast over the last few years, and running both is very minimal overhead. Functions such as upgrading Nextcloud     to newer versions is seamless especially when using Docker.</li> <li>The power of Memories is integration: the Nextcloud ecosystem provides tons of other apps for extending functionality.</li> </ol> <p>Why doesn't it support <code>&lt;some-feature&gt;</code> such as XMP tags and advanced metadata editing?</p> <p>The target user of Memories is not a tech-savvy self-hoster. Most commonly used / available features will be given priority over advanced features, e.g. most useful for professionals / photographers / data hoarders. That doesn't mean to say these features will necessarily not be implemented.</p> <p>Does Memories support a folder structure for storage?</p> <p>Yes. All photos are stored in a folder structure, and only displayed as a flat timeline. This means you can swap out Memories for any other photo app if you want (no lock-in). You can also view the photos in the folder structure if you desire.</p> <p>Does it have a mobile app?</p> <p>Not yet. The web app is very responsive on mobile. You can use the official Nextcloud app to auto-upload photos and videos from your device.</p> <p>How is it better than the <code>Y</code> FOSS photo manager?</p> <p>UX and performance. The devil is in the details.</p> <p>It's slow or doesn't work</p> <p>Make sure you follow the troubleshooting steps. Unless you have hundreds of thousands of photos on a Raspberry Pi, Memories should be very fast. File an issue otherwise.</p> <p>It says \"nothing to show here\" on startup?</p> <p>Indexing is performed in the background, and can take a while depending on the number of photos. Follow the configuration steps and be patient.</p> <p>Will it run on my system?</p> <p>In general, if you can run Nextcloud, you should be able to run Memories. File an issue if you run into problems.</p>"},{"location":"file-types/","title":"File type support","text":"<p>Memories supports the file types supported by the Nextcloud previews app. If you add support for any one of the file types below, you must run <code>occ memories:index</code> to index these files.</p>"},{"location":"file-types/#common-formats","title":"Common Formats","text":"<pre><code>PNG (image/png)\nJPEG (image/jpeg)\nGIF (image/gif)\nBMP (image/bmp)\n</code></pre> <p>These are enabled by having the following in your <code>config.php</code>,</p> <pre><code>'enabledPreviewProviders' =&gt;\narray (\n  'OC\\\\Preview\\\\Image',\n),\n</code></pre>"},{"location":"file-types/#heic-and-tiff","title":"HEIC and TIFF","text":"<p>You must enable <code>HEIC</code> and <code>TIFF</code> in Nextcloud <code>config.php</code>, and install Imagemagick (included in the official Nextcloud docker image)</p> <p>In <code>config.php</code>, add,</p> <pre><code>'enabledPreviewProviders' =&gt;\narray (\n  'OC\\\\Preview\\\\HEIC',\n  'OC\\\\Preview\\\\TIFF',\n),\n</code></pre>"},{"location":"file-types/#videos","title":"Videos","text":"<p>You need to install <code>ffmpeg</code> and add the video config to <code>config.php</code></p> <pre><code>'enabledPreviewProviders' =&gt;\narray (\n  'OC\\\\Preview\\\\Movie',\n),\n</code></pre>"},{"location":"file-types/#raw-images","title":"RAW images","text":"<p>Install the camera raw previews app from the Nextcloud app store.</p>"},{"location":"hw-transcoding/","title":"Hardware transcoding","text":"<p>Memories supports transcoding acceleration with VA-API and NVENC.</p>"},{"location":"hw-transcoding/#external-transcoder","title":"External Transcoder","text":"<p>If you plan to use hardware transcoding, it may be easier to run the transcoder (go-vod) in a separate docker image containing ffmpeg and hardware acceleration dependencies. For this, you need to clone the go-vod repository and build the docker image. Then you need to change the vod connect address and mark go-vod as external. The important requirement for running go-vod externally is that the file structure must be exactly same for the target video files.</p> <p>In the directory with the <code>docker-compose.yml</code> file, run,</p> <pre><code>git clone https://github.com/pulsejet/go-vod\n</code></pre> <p>If you are using docker compose, configure a service to start go-vod with the correct devices and filesystem structure. Otherwise, manually start the container with these parameters.</p> <pre><code># docker-compose.yml\nservices:\napp:\nimage: nextcloud\nrestart: always\ndepends_on:\n- db\n- redis\nvolumes:\n- ncdata:/var/www/html\ngo-vod:\nbuild: ./go-vod\nrestart: always\ndevices:\n- /dev/dri:/dev/dri\nvolumes:\n- ncdata:/var/www/html:ro\n</code></pre> <p>Finally, point Memories to the external go-vod instance. In the admin interface, set go-vod to external and configure the connect URL to <code>go-vod:47788</code>. Alternatively, add the following configuration to <code>config.php</code>:</p> <pre><code>'memories.vod.external' =&gt; true,\n'memories.vod.connect' =&gt; 'go-vod:47788',\n</code></pre>"},{"location":"hw-transcoding/#va-api","title":"VA-API","text":"<p>These instructions are not applicable for external transcoders</p> <p>Newer Intel processors come with a feature called QuickSync that can significantly boost transcoding performance (4-5x improvement over x264 is common). QuickSync can be used for hardware accelerated transcoding using the VA-API in ffmpeg.</p> <p>Note: VA-API acceleration may also work with some AMD GPUs.</p> <p>To configure VAAPI, you need to have <code>/dev/dri</code> available to the Nextcloud instance with the <code>www-data</code> in the group owning the drivers. You also need the correct drivers and a compatible version of ffmpeg installed.</p> <p>Ubuntu:</p> <pre><code>sudo apt-get update\nsudo apt-get install -y intel-media-va-driver-non-free ffmpeg\n</code></pre> <p>Alpine:</p> <pre><code>apk update\napk add --no-cache bash ffmpeg libva-utils libva-vdpau-driver libva-intel-driver intel-media-driver mesa-va-gallium\n</code></pre>"},{"location":"hw-transcoding/#docker-installations","title":"Docker installations","text":"<p>If you use Docker, you need to:</p> <ol> <li>Pass the <code>/dev/dri</code> device to the container. In <code>docker-compose.yml</code>:    <pre><code>app:\nbuild: .\nrestart: always\ndevices:\n- /dev/dri:/dev/dri\n</code></pre></li> <li>Make sure the right drivers are installed. This can be done using a custom Dockerfile, for example</li> </ol> <pre><code>FROM nextcloud:25\nRUN apt-get update &amp;&amp; \\\napt-get install -y software-properties-common &amp;&amp; \\\napt-add-repository -y non-free &amp;&amp; \\\napt-get update &amp;&amp; \\\napt-get install -y intel-media-va-driver-non-free ffmpeg &amp;&amp; \\\nrm -rf /var/lib/apt/lists/*\n\nCOPY start.sh /\nCMD /start.sh\n</code></pre> <p>In <code>start.sh</code>,</p> <pre><code>#!/bin/bash\nGID=`stat -c \"%g\" /dev/dri/renderD128`\ngroupadd -g $GID render2 || true # sometimes this is needed\nGROUP=`getent group $GID | cut -d: -f1`\nusermod -aG $GROUP www-data\n\nphp-fpm\n</code></pre> <ol> <li>Check the output of <code>/tmp/go-vod/&lt;instance-id&gt;.log</code> if playback has issues</li> </ol>"},{"location":"hw-transcoding/#linuxservernextcloud-image","title":"linuxserver/nextcloud image","text":"<p>You can add the following to the <code>docker-compose.yml</code> file to install the drivers:</p> <pre><code>devices:\n- /dev/dri:/dev/dri\nenvironment:\n- DOCKER_MODS=linuxserver/mods:universal-package-install\n- INSTALL_PACKAGES=libva|libva-intel-driver|intel-media-driver|mesa-va-gallium\n</code></pre>"},{"location":"hw-transcoding/#ffmpeg-from-source","title":"FFmpeg from source","text":"<p>In some cases, you may need to build the drivers and <code>ffmpeg</code> from source. For example, the available version of the media driver for the current debian image used by Nextcloud only supports upto Ice Lake CPUs. This recipe might be useful.</p> <pre><code>FROM nextcloud:25\n# Enable QSV support\nSHELL [\"/bin/bash\", \"-c\"]\nRUN apt-get update &amp;&amp; \\\napt-get install -y sudo curl git &amp;&amp; \\\nrm -rf /var/lib/apt/lists/*\nRUN curl https://gist.githubusercontent.com/pulsejet/4d81c1356703b2c8ba19c1ca9e6f6e50/raw/qsv-docker.sh | bash\n\n...\n</code></pre>"},{"location":"install/","title":"Installation","text":"<p>This page describes how to install the latest version of Memories.</p>"},{"location":"install/#nextcloud","title":"Nextcloud","text":"<p>Memories is an app for Nextcloud, so you need to install Nextcloud first. You can find the installation instructions here.</p> <p>For the best experience, we recommend to use the latest stable version of Nextcloud and PHP. For easy setup and maintenance, you can use the official Nextcloud Docker image, and add extra dependencies using a custom Dockerfile.</p>"},{"location":"install/#requirements","title":"Requirements","text":"<p>Before installing Memories, make sure that the following requirements are met:</p> <ol> <li>Nextcloud 25 or later.</li> <li>PHP 8.0 or later.</li> <li>MySQL, MariaDB, or PostgreSQL database.</li> <li>Imagick PHP extension.</li> <li>ffmpeg and ffprobe binaries.</li> </ol>"},{"location":"install/#installing-memories","title":"Installing Memories","text":"<p>Memories can be installed from the Nextcloud app store page. Alternatively, you can install it manually by following these steps:</p> <ol> <li>Download the latest release from the releases page</li> <li>Extract the archive to the <code>apps</code> or <code>custom_apps</code> directory of your Nextcloud installation.</li> <li>Enable the app in the Nextcloud app settings page.</li> <li>Make sure you follow the configuration instructions carefully.</li> </ol>"},{"location":"install/#installing-from-source","title":"Installing from source","text":"<p>To build the app from source, you need to have node.js installed.</p> <ol> <li>Clone the repository to the <code>apps</code> or <code>custom_apps</code> directory of Nextcloud.</li> <li>Run <code>make dev-setup</code> to install the dependencies.</li> <li>Run <code>make patch-external</code> to apply patches to external dependencies.</li> <li>Run <code>make build-js-production</code> to build the JavaScript files.</li> <li>Enable the app in the Nextcloud app settings page.</li> </ol>"},{"location":"memories-vs-photos/","title":"Memories vs Photos","text":"<p>Nextcloud comes bundled with an official \"Photos\" app. This page provides a brief feature comparison between Memories and Photos, and links some relevant issues in the Photos repository.</p>"},{"location":"memories-vs-photos/#features-in-memories-missing-in-photos","title":"Features in Memories missing in Photos","text":"<ol> <li>Sorting by Date Taken: The Photos app sorts images and videos by the file modification time. Memories uses the EXIF data to get the Date Taken, providing for the correct sort order regardless if the files are edited / touched later (issue).</li> <li>Scrubbable Timeline: Both apps provide an infinite virtual scroll. However, Photos has no way to jump at any time in the past, and you need to scroll through all photos to get to any point. Memories provides a scroller to directly jump to any date in the timeline (issue).</li> <li>Limiting to a single root for Photos: Memories can scan through photos in a single (or multiple) directory. Photos scans everything the user has (issue).</li> <li>Video Transcoding: Memories supports all video file formats with live adaptive transcoding, along with quality selection. Photos only supports videos compatible with the user's browser at full resolution.</li> <li>Archive: Allows separating photos to a different folder quickly. Photos has no equivalent function.</li> <li>External Folder Sharing: Allows sharing a folder to non-Nextcloud users. Photos has no equivalent function (issue).</li> <li>EXIF Data Editing: Memories allows basic editing of EXIF data including fields such as date taken, title, description etc. Photos has no equivalent function.</li> <li>Support for iOS and Google Live Photos: Memories supports live photos, Photos does not. (issue, issue)</li> <li>Advanced Multi-Selection: Memories supports all multi-selection methods including selecting a day, selecting with Shift+Click and with Touch+Drag. Photos does not support these (issue, issue)</li> <li>Viewer Gestures: Memories provides a superior photo viewer experience, including gestures such as zoom in and out using touch.</li> <li>Preview pipelining: For maximum performance, Memories highly optimizes loading thumbnails, whereas Photos loads them one by one.</li> <li>Server-side image editing: The image editor in Memories works server-side allowing editing of large images and all formats (such as HEIC). The Photos image editor works client-side with HTML5 canvas, limiting it's capabilities and the quality of output.</li> </ol>"},{"location":"memories-vs-photos/#features-in-photos-missing-in-memories","title":"Features in Photos missing in Memories","text":"<ol> <li>Photos supports uploading photos directly, Memories does not support this function.</li> </ol>"},{"location":"system-config/","title":"config.php options","text":"<p>This is a list of all options in <code>config.php</code> that memories uses</p> <pre><code>&lt;?php\nreturn [\n// Path to exiftool binary\n'memories.exiftool' =&gt; '',\n// Do not use packaged binaries of exiftool\n// This requires perl to be available\n'memories.exiftool_no_local' =&gt; false,\n// How to index user directories\n// 0 = auto-index disabled\n// 1 = index everything\n// 2 = index only user timelines\n// 3 = index only configured path\n'memories.index.mode' =&gt; '1',\n// Path to index (only used if indexing mode is 3)\n'memories.index.path' =&gt; '/',\n// Places database type identifier\n'memories.gis_type' =&gt; -1,\n// Disable transcoding\n'memories.vod.disable' =&gt; true,\n// VA-API configuration options\n'memories.vod.vaapi' =&gt; false,  // Transcode with VA-API\n'memories.vod.vaapi.low_power' =&gt; false, // Use low_power mode for VA-API\n// NVENC configuration options\n'memories.vod.nvenc' =&gt; false,  // Transcode with NVIDIA NVENC\n'memories.vod.nvenc.temporal_aq' =&gt; false,\n'memories.vod.nvenc.scale' =&gt; 'npp', // npp or cuda\n// Paths to ffmpeg and ffprobe binaries\n'memories.vod.ffmpeg' =&gt; '',\n'memories.vod.ffprobe' =&gt; '',\n// Path to go-vod binary\n'memories.vod.path' =&gt; '',\n// Path to use for transcoded files (/tmp/go-vod/instanceid)\n// Make sure this has plenty of space\n'memories.vod.tempdir' =&gt; '',\n// Bind address to use when starting the transcoding server\n'memories.vod.bind' =&gt; '127.0.0.1:47788',\n// Address used to connect to the transcoding server\n// If not specified, the bind address above will be used\n'memories.vod.connect' =&gt; '127.0.0.1:47788',\n// Mark go-vod as external. If true, Memories will not attempt to\n// start go-vod if it is not running already.\n'memories.vod.external' =&gt; false,\n// Set the default video quality for a first time user\n//    0 =&gt; Auto (default)\n//   -1 =&gt; Original (max quality with transcoding)\n//   -2 =&gt; Direct (disable transcoding)\n// 1080 =&gt; 1080p (and so on)\n'memories.video_default_quality' =&gt; '0',\n// Memories only provides an admin interface for these\n// https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/config_sample_php_parameters.html#previews\n'enabledPreviewProviders' =&gt; [],\n'preview_max_x' =&gt; 4096,\n'preview_max_y' =&gt; 4096,\n'preview_max_memory' =&gt; 128,\n'preview_max_filesize_image' =&gt; 50,\n];\n</code></pre>"},{"location":"troubleshooting/","title":"Troubleshooting","text":"<p>This page contains solutions to common problems. If you are facing any issues, please refer to this page before opening an issue.</p>"},{"location":"troubleshooting/#performance","title":"Performance","text":"<p>Memories is very fast, but its performance largely depends on how well the Nextcloud instance is tuned. Make sure to follow the following steps:</p> <ul> <li>Make sure you are running the latest stable version of Nextcloud and Memories.</li> <li>Follow the steps in the server tuning documentation.</li> <li> <p>Follow all configuration steps in the configuration documentation.</p> <ul> <li>Disable video transcoding if your server is not powerful enough.</li> <li>Reduce the maximum size of previews to be generated.</li> </ul> </li> <li> <p>Make sure you are running HTTPS (very important).</p> </li> <li>Enable HTTP/2 or HTTP/3 on your server.</li> <li>Enable and configure PHP Opcache and JIT.</li> <li>Enable and configure the APCu cache.</li> <li>Enable and configure Redis for transactional file locking.</li> <li>Enable gzip compression on your HTTP server for static assets (CSS/JS).</li> </ul>"},{"location":"troubleshooting/#no-photos-are-shown","title":"No photos are shown","text":"<p>This means that Memories is unable to find any indexed photos in your Nextcloud instance. Make sure you have followed the configuration steps. Note that Memories indexes photos in the background, so it may take a while for the photos to show up. Ensure that Nextcloud's cron system is properly configured and running.</p>"},{"location":"troubleshooting/#issues-with-docker","title":"Issues with Docker","text":"<p>Note: Using the official Nextcloud Docker image is the recommended way of running Memories. If you are using a different image, you may run into issues.</p>"},{"location":"troubleshooting/#occ-commands-fail","title":"OCC commands fail","text":"<p>The most common reason for this is a missing interactive TTY. Make sure you run the commands with <code>-it</code>:</p> <pre><code>docker exec -it my_nc_container php occ memories:index\n#           ^^^  &lt;-- this is required\n</code></pre> <p>OCCWeb</p> <p>The OCCWeb app is deprecated, and will not work with Memories. You must use the <code>occ</code> command line.</p>"},{"location":"troubleshooting/#usage-of-tmpfs","title":"Usage of tmpfs","text":"<p>If you are using <code>tmpfs</code> (e.g. for the Recognize app), make sure the temp directory is set to executable. With Docker compose, your <code>docker-compose.yml</code> should look like this:</p> <pre><code>app:\n...\ntmpfs:\n- /tmp:exec\n</code></pre>"},{"location":"troubleshooting/#reverse-geocoding-places","title":"Reverse Geocoding (Places)","text":"<p>You need to have a MySQL / MariaDB / Postgres database for reverse geocoding to work. SQLite is not supported.</p>"},{"location":"troubleshooting/#planet-db-download-fails","title":"Planet DB download fails","text":"<p>If the planet DB download does not complete via the admin interface, you need to use the OCC command line, or increase the connection timeout values for your PHP/HTTP servers.</p> <pre><code>occ memories:places-setup\n</code></pre>"},{"location":"troubleshooting/#error-incorrect-string-value","title":"Error: Incorrect string value","text":"<p>If you get this error, it is likely that your database is not using the <code>utf8mb4</code> character set. Since the reverse geocoding database contains characters in various languages, it is necessary to use <code>utf8mb4</code> to store them. To fix this, you need to convert your database to use <code>utf8mb4</code>.</p>"},{"location":"troubleshooting/#reset","title":"Reset","text":"<p>If you want to completely reset Memories (e.g. for database trouble), uninstall it from the app store, then run the following SQL on your database to clean up any data.</p> <pre><code>DROP TABLE IF EXISTS oc_memories;\nDROP TABLE IF EXISTS oc_memories_livephoto;\nDROP TABLE IF EXISTS oc_memories_mapclusters;\nDROP TABLE IF EXISTS oc_memories_places;\nDROP TABLE IF EXISTS oc_memories_planet;\nDROP TABLE IF EXISTS memories_planet_geometry;\nDROP INDEX IF EXISTS memories_parent_mimetype ON oc_filecache; /* MySQL */\nDELETE FROM oc_migrations WHERE app='memories';\n</code></pre> <p>On Postgres, the syntax for dropping the index is:</p> <pre><code>DROP INDEX IF EXISTS memories_parent_mimetype;\n</code></pre>"}]}